"use strict";var D=Object.create;var g=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var z=(t,e)=>{for(var a in e)g(t,a,{get:e[a],enumerable:!0})},A=(t,e,a,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of M(e))!W.call(t,l)&&l!==a&&g(t,l,{get:()=>e[l],enumerable:!(o=L(e,l))||o.enumerable});return t};var T=(t,e,a)=>(a=t!=null?D(V(t)):{},A(e||!t||!t.__esModule?g(a,"default",{value:t,enumerable:!0}):a,t)),F=t=>A(g({},"__esModule",{value:!0}),t);var J={};z(J,{default:()=>H});module.exports=F(J);var r=require("@raycast/api"),x=require("react");var c=require("@raycast/api");var f=T(require("react")),i=require("@raycast/api");var R=require("react/jsx-runtime");var u=require("fs");var P=require("path");var $=T(require("node:os"),1),d,b;function w(t){if(typeof t!="string")throw new TypeError(`Expected a string, got ${typeof t}`);if(d===void 0&&(d=$.default.homedir()),d&&/^~(?=$|\/|\\)/.test(t))return t.replace(/^~/,d);let e=t.match(/^~([^/\\]+)(.*)/);if(e&&(b===void 0&&(b=$.default.userInfo().username),b)){let a=e[1],o=e[2];if(a===b)return d+o}return t}var h=require("react/jsx-runtime"),m=(0,c.getPreferenceValues)(),p=w(m.downloadsFolder??"~/Downloads"),N=m.showHiddenFiles,j=m.fileOrder,ae=m.lastestDownloadOrder,_=m.downloadsLayout??"list",B=[".png",".jpg",".jpeg",".gif",".webp",".bmp",".tiff",".heic",".svg"];function U(t){let e=t.lastIndexOf(".");if(e===-1)return!1;let a=t.toLowerCase().slice(e);return B.includes(a)}function k(){return(0,u.readdirSync)(p).filter(e=>N||!e.startsWith(".")).map(e=>{let a=(0,P.join)(p,e);try{let o=(0,u.statSync)(a);return{file:e,path:a,lastModifiedAt:o.mtime,createdAt:o.ctime,addedAt:o.atime,birthAt:o.birthtime}}catch(o){console.warn(`Skipping '${a}' because it could not be stat'd:`,o);return}}).filter(e=>!!e).map(e=>e).sort((e,a)=>{switch(j){case"addTime":return a.addedAt.getTime()-e.addedAt.getTime();case"createTime":return a.createdAt.getTime()-e.createdAt.getTime();case"modifiedTime":default:return a.lastModifiedAt.getTime()-e.lastModifiedAt.getTime()}})}function G(){try{return(0,u.accessSync)(p,u.constants.R_OK),!0}catch(t){return console.error(t),!1}}var C=t=>e=>G()?(0,h.jsx)(t,{...e}):(0,h.jsx)(c.Detail,{markdown:`## Permission Required

The Downloads Manager extension requires access to your Downloads folder. Please grant permission to use it.

![Grant Permission](permission.png)`,actions:(0,h.jsx)(c.ActionPanel,{children:(0,h.jsx)(c.Action.Open,{title:"Grant Permission",target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"})})});var s=require("react/jsx-runtime");function K(){let[t,e]=(0,x.useState)(k()),[a,o]=(0,x.useState)(_);function l(n){e(y=>y.filter(E=>Array.isArray(n)?!n.includes(E.path):n!==E.path))}function I(){e(k())}let O=n=>(0,s.jsxs)(r.ActionPanel,{children:[(0,s.jsxs)(r.ActionPanel.Section,{children:[(0,s.jsx)(r.Action.Open,{title:"Open File",target:n.path}),(0,s.jsx)(r.Action.ShowInFinder,{path:n.path}),(0,s.jsx)(r.Action.CopyToClipboard,{title:"Copy File",content:{file:n.path},shortcut:{modifiers:["cmd","shift"],key:"c"}}),(0,s.jsx)(r.Action,{title:"Reload Downloads",icon:r.Icon.RotateAntiClockwise,shortcut:{modifiers:["cmd"],key:"r"},onAction:I})]}),(0,s.jsxs)(r.ActionPanel.Section,{children:[(0,s.jsx)(r.Action.OpenWith,{path:n.path,shortcut:{modifiers:["cmd"],key:"o"}}),(0,s.jsx)(r.Action.ToggleQuickLook,{shortcut:{modifiers:["cmd"],key:"y"}}),(0,s.jsx)(r.Action,{title:"Toggle Layout",icon:a==="list"?r.Icon.AppWindowGrid3x3:r.Icon.AppWindowList,shortcut:{modifiers:["cmd"],key:"l"},onAction:()=>o(a==="list"?"grid":"list")})]}),(0,s.jsxs)(r.ActionPanel.Section,{children:[(0,s.jsx)(r.Action.Trash,{title:"Delete Download",paths:n.path,shortcut:{modifiers:["ctrl"],key:"x"},onTrash:l}),(0,s.jsx)(r.Action.Trash,{title:"Delete All Downloads",paths:t.map(y=>y.path),shortcut:{modifiers:["ctrl","shift"],key:"x"},onTrash:l})]})]}),v={icon:{fileIcon:p},title:"No downloads found",description:"Well, first download some files \xAF\\_(\u30C4)_/\xAF"},S=n=>({title:n.file,quickLook:{path:n.path,name:n.file},actions:O(n)});return a==="grid"?(0,s.jsxs)(r.Grid,{columns:8,children:[t.length===0&&(0,s.jsx)(r.Grid.EmptyView,{...v}),t.map(n=>(0,s.jsx)(r.Grid.Item,{...S(n),content:U(n.file)?{source:n.path}:{fileIcon:n.path}},n.path))]}):(0,s.jsxs)(r.List,{children:[t.length===0&&(0,s.jsx)(r.List.EmptyView,{...v}),t.map(n=>(0,s.jsx)(r.List.Item,{...S(n),icon:{fileIcon:n.path},accessories:[{date:n.lastModifiedAt,tooltip:`Last modified: ${n.lastModifiedAt.toLocaleString()}`}]},n.path))]})}var H=C(K);
